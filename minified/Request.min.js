XMLHttpRequest.prototype.addListener=function(a,b,c,d){this["__"+b+"_bindValue"]=d?c?c[b].bind(c,d):c[b]:c?c[b].bind(c):c[b];this.addEventListener(a,this["__"+b+"_bindValue"],!1)};XMLHttpRequest.prototype.removeListener=function(a,b){this.removeEventListener(a,this["__"+b+"_bindValue"],!1);delete this["__"+b+"_bindValue"]};var Request=AVObj.extend();
Request.properties={init:function(a,b,c,d,e){this.request=new XMLHttpRequest;this.method=a;this.url=b;this.asynchronous=c;this.finishFunction=d;this.data=e;null==this.request?console.error("Browser does not support XMLHTTPRequest."):"string"===typeof b?(this.request.addListener("error","transferError",this),"POST"===a?this.sendPostRequest():"GET"===a?this.sendGetRequest():console.error('no method defined. Please set to "POST" or "GET".')):console.error("URL is not defined or is not a string.")},deInit:function(){delete this.request;
delete this.method;delete this.url;delete this.asynchronous;delete this.finishFunction;delete this.data},transferError:function(){console.error("An error has occurred while transferring the data.")},sendGetRequest:function(){this.request.open(this.method,this.url+"?"+this.convertToString(),this.asynchronous);this.asynchronous?(this.request.addListener("load","fireFunction",this),this.request.send(null)):(this.request.send(null),this.finishFunction({responseText:this.request.responseText}))},sendPostRequest:function(){this.request.open(this.method,
this.url,this.asynchronous);this.asynchronous?(this.request.addListener("load","fireFunction",this),this.request.send(this.convertToForm())):(this.request.send(this.convertToForm()),this.finishFunction({responseText:this.request.responseText}),this.destroy())},fireFunction:function(a){this.request.removeListener("error","transferError");this.request.removeListener("load","fireFunction");this.finishFunction(a.currentTarget);this.destroy()},kill:function(){this.request.removeListener("error","transferError");
this.request.removeListener("load","fireFunction");this.request.abort()},convertToString:function(){var a="";if("object"==typeof this.data){var b=!1,c;for(c in this.data)b?a+="&"+c+"="+encodeURIComponent(this.data[c]):(b=!0,a+=c+"="+encodeURIComponent(this.data[c]))}else"string"==typeof this.data&&(a=this.data);return a},convertToForm:function(){var a;if("object"==typeof this.data&&"undefined"!=typeof FormData)if(!1===this.data instanceof FormData){a=new FormData;for(var b in this.data)a.append(b,
this.data[b])}else a=this.data;else a=this.convertToString();"string"==typeof a&&this.request.setRequestHeader("Content-type","application/x-www-form-urlencoded");return a}};
