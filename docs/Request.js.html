<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils/Request.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils/Request.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * Copyright (c) 2014 Ian Carson - LinkedIn http://lnkd.in/9qJWap
 *
 * Project : AVObj - Making JS Simple.
 * Version : 0.6.1
 * License : MIT (http://www.opensource.org/licenses/mit-license.php)
 *
 * For the latest updates go to http://AVObject.net
 * Visit the wiki for howto information on getting started at https://github.com/Kabe0/AVObj/wiki
 */

/**
* Allows you to add an observer defined by a scope. (does an addEventListener to an element)
* @param {String} event
* @param {String} functionName
* @param {object} scope
*/
XMLHttpRequest.prototype.addListener = function (event, functionName, scope, options)
{
	if(options)
	{
		this['__' + functionName + '_bindValue'] = (scope ? scope[functionName].bind (scope, options) : scope[functionName]);
	}
	else
	{
		this['__' + functionName + '_bindValue'] = (scope ? scope[functionName].bind (scope) : scope[functionName]);
	}
	this.addEventListener (event, this['__' + functionName + '_bindValue'], false);
};
/**
 *
 * @param {String} event
 * @param {String} functionName
 */
XMLHttpRequest.prototype.removeListener  = function (event, functionName)
{
	this.removeEventListener (event, this['__' + functionName + '_bindValue'], false);
	delete this['__' + functionName + '_bindValue']
};

// We are promising the JavaScript compiler that all the values will exists later on.
namespace( "AV.Utilities", function()
{
	this.Request = AVObj.extend().prop(
	{
		/**
		 * Call Request Init to create a request for a specific page.
		 *
		 * @param method The way the data should be sent. (Either Post or Get).
		 * @param url The path to the file you want to load.
		 * @param asynchronous If the event should halt all other processes.
		 * @param finishFunction The function that will fire once the call is completed.
		 * @param data Additional info such as form data goes here.
		 * @constructor AV.Utilities.Request
		 *
		 * @classdesc The Request class is used for creating ajax page requests. Note that once the Request has been complete,
		 * the object will self destruct as soon as the requested data is returned.
		 */
		init: function ( method, url, asynchronous, finishFunction, data )
		{
			this.request = new XMLHttpRequest();
			this.method = method;
			this.url = url;
			this.asynchronous = asynchronous;
			this.finishFunction = finishFunction;
			this.data = data;

			if ( this.request == null )
			{
				console.error( "Browser does not support XMLHTTPRequest." );
			}
			else if ( typeof url === 'string' )
			{
				this.request.addListener( "error", 'transferError', this );
				if ( method === "POST" )
				{
					this.sendPostRequest();
				}
				else if ( method === "GET" )
				{
					this.sendGetRequest();
				}
				else
				{
					console.error( "no method defined. Please set to \"POST\" or \"GET\"." );
				}
			}
			else
			{
				console.error( "URL is not defined or is not a string." );
			}
		},

		deInit: function ()
		{
			delete this.request;
			delete this.method;
			delete this.url;
			delete this.asynchronous;
			delete this.finishFunction;
			delete this.data;
		},

		transferError: function ()
		{
			console.error( "An error has occurred while transferring the data." );
		},

		sendGetRequest: function ()
		{
			this.request.open( this.method, this.url + "?" + this.convertToString(), this.asynchronous );
			if ( !this.asynchronous )
			{
				this.request.send( null );
				this.finishFunction( {responseText: this.request.responseText} );
			}
			else
			{

				this.request.addListener( "load", 'fireFunction', this );
				this.request.send( null );
			}
		},

		sendPostRequest: function ()
		{
			this.request.open( this.method, this.url, this.asynchronous );
			if ( !this.asynchronous )
			{
				this.request.send( this.convertToForm() );
				this.finishFunction( {responseText: this.request.responseText} );
				this.destroy();
			}
			else
			{
				this.request.addListener( "load", 'fireFunction', this );
				this.request.send( this.convertToForm() );
			}
		},

		/**
		 * Fired when the request is complete
		 * @param e object to pass into the finish function.
		 */
		fireFunction: function ( e )
		{
			this.request.removeListener( "error", 'transferError' );
			this.request.removeListener( "load", 'fireFunction' );
			this.finishFunction( e.currentTarget );
			this.destroy();
		},

		/**
		 * Will stop the requests (only works on async calls).
		 */
		kill: function ()
		{
			this.request.removeListener( "error", 'transferError' );
			this.request.removeListener( "load", 'fireFunction' );
			this.request.abort();
		},

		/**
		 * Converts the data to a string format.
		 * @returns {string}
		 */
		convertToString: function ()
		{
			var newString = "";
			if ( typeof this.data == "object" )
			{
				var firstAnd = false;
				for ( var element in this.data )
				{
					if ( firstAnd )
					{
						//noinspection JSUnfilteredForInLoop
						newString += "&amp;" + element + "=" + encodeURIComponent( this.data[element] );
					}
					else
					{
						firstAnd = true;
						//noinspection JSUnfilteredForInLoop
						newString += element + "=" + encodeURIComponent( this.data[element] );
					}
				}
			}
			else if ( typeof this.data == 'string' ) newString = this.data;

			return newString;
		},

		/**
		 * Converts the data to a FormData format.
		 * @returns {*}
		 */
		convertToForm: function ()
		{
			var object;
			if ( typeof this.data == "object" &amp;&amp; typeof FormData != 'undefined' )
			{
				if ( this.data instanceof FormData === false )
				{
					object = new FormData();
					for ( var element in this.data )
					{ //noinspection JSUnfilteredForInLoop
						object.append( element, this.data[element] );
					}
				}
				else
				{
					object = this.data;
				}
			}
			else object = this.convertToString();

			if ( typeof object == 'string' )
				this.request.setRequestHeader( "Content-type", "application/x-www-form-urlencoded" );

			return object;
		}
	});
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="AV.Utilities.Node.html">Node</a></li><li><a href="AV.Utilities.Page.html">Page</a></li><li><a href="AV.Utilities.Request.html">Request</a></li><li><a href="AVObj.html">AVObj</a></li><li><a href="CodeDecorator.CodeDecorator.html">CodeDecorator</a></li></ul><h3>Namespaces</h3><ul><li><a href="AV.html">AV</a></li><li><a href="AV.AVApp.html">AVApp</a></li><li><a href="AV.Utilities.html">Utilities</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AVObjMacro">AVObjMacro</a></li><li><a href="global.html#buildTemplate">buildTemplate</a></li><li><a href="global.html#checkQueryStates">checkQueryStates</a></li><li><a href="global.html#convertToForm">convertToForm</a></li><li><a href="global.html#convertToString">convertToString</a></li><li><a href="global.html#fireFunction">fireFunction</a></li><li><a href="global.html#getLayerInstruct">getLayerInstruct</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#Interpreter">Interpreter</a></li><li><a href="global.html#kill">kill</a></li><li><a href="global.html#LayerTransitionBase">LayerTransitionBase</a></li><li><a href="global.html#namespace">namespace</a></li><li><a href="global.html#pushLayer">pushLayer</a></li><li><a href="global.html#usingNamespace">usingNamespace</a></li><li><a href="global.html#View">View</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha9</a> on Fri Oct 31 2014 08:28:23 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
